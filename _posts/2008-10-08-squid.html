---
layout: post
name: squid
title: 基于多端口控制的Squid二级代理设置方法
time: 2008-10-08 15:19:00.000000000 +08:00
---
<div dir="ltr">基于端口的二级代理 by&nbsp;Liu&nbsp;Lantao<br>转载请注明出处<a href="http://www.liulantao.com">www.liulantao.com</a><br><br>学校的网络限制了免费访问的范围，校园网以外的内容访问很不方便。有了一台代理服务器G之后，平时的上网问题可以解决了。过程如图<br>+--------------+-----------------+<br>个人电脑------代理G-----------外网<br> <br>可是G在学校机房里，访问的ip范围受到限制。于是想到改造上面的方式，通过设置二级代理的方式来访问那些受限网站。<br>这个解决方案的结构很简单(假设增加的代理L端口为80)：<br>+-------------+-------------+-------------+<br>个人电脑-----代理G-------代理L:80-------受限ip<br><br>因为通过了代理P，访问速度会受到影响，所以不希望一直使用它。于是要保留两个访问通路。<br> 两个通路通过不同端口来区别。传统的3128端口不做改变，而增加一个自定义的19999端口。<br>+-------------+-----------------+<br> 个人电脑----代理G:3128------外网<br> +-------------+-------------------+-------------+<br> 个人电脑----代理G:19999----代理L:80-------受限ip<br><br>下面是在默认配置文件增加的内容，其中第一部分是3128端口直接连接的设置，第二部分是19999端口二级代理的设置：<br>#######################<br># Part I<br>acl lax src <a href="http://172.16.120.1/24">172.16.120.1/24</a><br>http_access allow lax<br> <br>#######################<br># Part II<br>http_port 19999<br>acl out-lax myport 19999<br>cache_peer <a href="http://www.liulantao.com">www.liulantao.com</a> parent 80 0 no-query<br>cache_peer_access <a href="http://www.liulantao.com">www.liulantao.com</a> allow out-lax<br> cache_peer_access <a href="http://www.liulantao.com">www.liulantao.com</a> deny !lax<br>#######################<br><br>如果有任何问题，发邮件给我。<br>-- <br>Liu Lantao<br>College of Information Science and Technology, Beijing Normal University<br> EMAIL: liulantao ( at ) gmail ( dot ) com ; <br>WEBSITE: <a href="http://www.liulantao.com/">http://www.liulantao.com/</a> .<br>------<br> </div> <div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/4666702678549991852-5162608152246984047?l=liulantao.blogspot.com' alt='' /></div>
