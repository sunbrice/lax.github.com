
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>非正常生活 << [Idea, Code, Life]</title>
    
    <meta name="author" content="Liu Lantao">
    <meta property="wb:webmaster" content="08beceac65f1ad4f" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">


    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/default.min.css">
  </head>

  <body>

  <div class="navbar-wrapper">
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">非常规思维研究所</a>
          <ul class="nav">
            <li><a href="/">首页</a></li>
            
            
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      	
      	<li><a href="/urls_for_nerd.html">Nerd URLs</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  




          </ul>
        </div>
      </div>
    </div>
  </div>

    <div class="container">

      <div class="content">
        

<div class='container'>
  <div class='span8'>

  <!-- Pagination links -->
  
    <ul class="pager">

  <li class="previous">
  
    <a href="/page6">&larr; Previous</a>
  
  </li>



  <li class="next">
    <a href="/page8">Next &rarr;</a>
  </li>

</ul>

  

  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-08-11 19:36:00 +0800">11 Aug 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/08/11/twittere79a84e5bfabe9809fe7a88be5ba8fe983a8e7bdb2.html" title="Twitter的快速程序部署" rel="bookmark">Twitter的快速程序部署</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <p>Twitter早期的更新采用Capistrano和Git，每次程序更新时间与服务起数目呈线性关系。当服务器数量迅速增加时，更新       效率开始成为问题。
基于中心代码库，更新时代码库压力较大。通过增加Git库的副本，可以缓解问题，但是从长期看，需要持续进行Git库扩展。</p>

<p>后来，Twitter引入去中心化的方案，在程序更新中采用BitTorrent，将更新时间从40分钟降低到12秒！</p>

<p>Capistrano： Ruby世界流行的一个部署框架，在实际服务器上执行任务。
Git：代码管理。
Murder：启动BTtracker，创建seeds，文件传输等任务。
BitTornado：对BitTorrent改造，更适合DataCenter内部高质量的网络环境。</p>

<h1 id="murder-fast-datacenter-code-deploys-using-------bittorrent">Murder: Fast datacenter code deploys using       BitTorrent</h1>

<h2 id="thursday-july-15-2010">Thursday, July 15, 2010</h2>

<p>Twitter has thousands of servers. What makes having           boatloads of servers particularly annoying though is that we           need to quickly get multiple iterations of code and binaries           onto all of them on a regular basis. We used to have a           git-based deploy system where we’d just instruct our           front-ends to download the latest code from our main git           machine and serve that. Unfortunately, once we got past a few           hundred servers, things got ugly. We recognized that this           problem was not unlike many of the scaling problems we’ve had           and dealt with in the past though &ndash; we were suffering the           symptoms of a centralized system.</p>

<p>By sitting beside a particularly vocal Release Engineer, I           received first-hand experience of the frustration caused by           slow deploys. We needed a way to dramatically speed things up.           I thought of some quick hacks to get this fixed: maybe           replicate the git repo or maybe shard it so everyone isn’t           hitting the same thing at once. Most of these           quasi-centralized solutions will still require re-replicating           or re-sharding again in the near future though (especially at           our growth). It was time for something completely different,           something decentralized, something more like.. <a href="http://bittorrent.com/">BitTorrent</a>.. running           inside of our datacenter to quickly copy files around. Using           the file-sharing protocol, we launched a side-project called           Murder and after a few days (and especially nights) of nervous           full-site tinkering, it turned a 40 minute deploy process into           one that lasted just 12 seconds!</p>

<p>Murder (which by the way is the name for a <a href="http://en.wikipedia.org/wiki/List_of_collective_nouns_for_birds">flock             of crows</a>) is a combination of scripts written in Python           and Ruby to easily deploy large binaries throughout your           company’s datacenter(s). It takes advantage of the fact that           the environment in a datacenter is somewhat different from           regular internet connections: low-latency access to servers,           high bandwidth, no NAT/Firewall issues, no ISP traffic           shaping, only trusted peers, etc. This let us come up with a           list of optimizations on top of BitTornado to make BitTorrent           not only reasonable, but also effective on our internal           network. Since at the time we used Capistrano for signaling           our servers to perform tasks, Murder also includes a           Capistrano deploy strategy to make it easy for existing users           of Capistrano to convert their file distribution to be           decentralized. The final component is the work Matt Freels (@<a href="http://twitter.com/mf">mf</a>) did in bundling           everything into an easy to install ruby gem. This further           helped get Murder to be usable for more deploy tasks at           Twitter.</p>

<p>Reference：
<a href="http://engineering.twitter.com/2010/07/murder-fast-datacenter-code-deploys.html">http://engineering.twitter.com/2010/07/murder-fast-datacenter-code-deploys.html</a>
Murder：（Python/Ruby）<a href="http://github.com/lg/murder">http://github.com/lg/murder</a></p>

          <a href="/Technology/2010/08/11/twittere79a84e5bfabe9809fe7a88be5ba8fe983a8e7bdb2.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#deploy-ref">deploy <span>1</span></a></li>
     
    	<li><a href="/tags.html#twitter-ref">twitter <span>1</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-07-19 19:14:58 +0800">19 Jul 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/07/19/linux-e9a9b1e58aa8e5bc80e58f91e79a84e5ada6e4b9a0e6ada5e9aaa4.html" title="Linux 驱动开发的学习步骤" rel="bookmark">Linux 驱动开发的学习步骤</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <p>Linux 驱动开发的学习步骤</p>

<p>发信人: ParadiseLost (AbuseyourdNa), 信区: Linux
标  题: Re: 求达人说一下linux驱动开发的学习步骤。。。
发信站: 北邮人论坛 (Mon May  5 01:15:25 2008), 站内</p>

<ol>
  <li>学会写简单的makefile</li>
  <li>编一应用程序，可以用makefile跑起来</li>
  <li>学会写驱动的makefile.</li>
  <li>写一简单char驱动，makefile编译通过，可以insmod, lsmod, rmmod. 在驱动的init函数里打印hello world, insmod后应该能够通过dmesg看到输出。</li>
  <li>写一完整驱动， 加上read, write, ioctl, polling等各种函数的驱动实现。 在ioctl里完成从用户空间向内核空间传递结构体的实现。</li>
  <li>写一block驱动， 加上read,write,ioctl,poll等各种函数实现。</li>
  <li>简单学习下内存管理，  这个是最难的，明白各种memory alloc的函数实现细节。这是linux开发的基本功</li>
  <li>学习锁机制的应用，这个不是最难的但是最容易犯错的，涉及到很多同步和并发的问题。</li>
  <li>看内核中实际应用的驱动代码。 你会发现最基本的你已经知道了， 大的框架都是一样的， 无非是read, write, ioctl等函数的实现， 但里面包含了很多很多细小的实现细节是之前不知道的。 这时候就要考虑到很多别的问题而不仅仅是基本功能的实现。
推荐您看2.6.20中integrated的一个驱动 kvm， 记得是在driver/lguest下，很好玩的， 就是linux下的虚拟机驱动，  代码不长，但功能强大。有能力的可以自己写一操作系统按照要求做成磁盘镜像加载到虚拟机中， 然后客户机可以有自己的4G虚拟地址空间。</li>
  <li>看完驱动欢迎您进入Linux kernel学习中来。</li>
</ol>

<p>最简单的方法，跟着ldd(linux devive driver)做一遍。</p>

          <a href="/Technology/2010/07/19/linux-e9a9b1e58aa8e5bc80e58f91e79a84e5ada6e4b9a0e6ada5e9aaa4.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#Linux-ref">Linux <span>5</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-07-19 19:14:30 +0800">19 Jul 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/07/19/e69599e4bda0e79b91e68ea7nginxe69c8de58aa1efbc9ae69687e4bbb6e4b88ae4bca0e69c8de58aa1loge9858de7bdae.html" title="教你监控Nginx服务：文件上传服务log配置" rel="bookmark">教你监控Nginx服务：文件上传服务log配置</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <p>教你监控Nginx服务：文件上传服务log配置</p>

<p>log_format upload ‘[$time_local] $status $host $upstream_addr $upstream_response_time $request_time $remote_addr $request_length $bytes_sent’;
access_log logs/upload.log upload;</p>

<p>变量说明：
$time_local  本地时间
$status           状态码
$host              主机名
$upstream_addr    后端地址
$upstream_response_time   后端响应时间
$request_time         请求时间
$remote_addr         用户地址
$request_length     请求长度
$bytes_sent             返回长度</p>

          <a href="/Technology/2010/07/19/e69599e4bda0e79b91e68ea7nginxe69c8de58aa1efbc9ae69687e4bbb6e4b88ae4bca0e69c8de58aa1loge9858de7bdae.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#Nginx-ref">Nginx <span>5</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-07-19 19:13:23 +0800">19 Jul 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/07/19/e6af8fe4b880e4b8aae8a2abnginxe7aea1e79086e59198e5b081e7a681ipe79a84e794a8e688b7efbc8ce4b88ae8be88e5ad90e983bde698afe68a98e7bfbce79a84.html" title="每一个被Nginx管理员封禁IP的用户，上辈子都是折翼的天使" rel="bookmark">每一个被Nginx管理员封禁IP的用户，上辈子都是折翼的天使</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <p>每一个被Nginx管理员封禁IP的用户，上辈子都是折翼的天使</p>

<p>方案一、</p>

<p>deny  120.7.0.1/16</p>

<p>方案二、</p>

<p>http {
&hellip;&hellip;
geo $ban {
default         0;  # 默认关闭
127.0.0.0/16    1;  # 针对网段打开；可以设置多行。
}
&hellip;&hellip;
server {
&hellip;&hellip;
# 在Server或Location里设置
location / {
if ($ban = 1) {
return 500;  # 返回500 code
}
&hellip;&hellip;
}
&hellip;&hellip;
}</p>

<p>&hellip;&hellip;
}</p>

<p>该配置使用了nginx的geo模块，该模块是nginx标准模块，默认编译是开启的。需要机器上安装有GeoIP支持库。
了解更多点击http://wiki.nginx.org/NginxHttpGeoModule</p>

          <a href="/Technology/2010/07/19/e6af8fe4b880e4b8aae8a2abnginxe7aea1e79086e59198e5b081e7a681ipe79a84e794a8e688b7efbc8ce4b88ae8be88e5ad90e983bde698afe68a98e7bfbce79a84.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#GeoIP-ref">GeoIP <span>1</span></a></li>
     
    	<li><a href="/tags.html#Nginx-ref">Nginx <span>5</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-07-19 19:11:22 +0800">19 Jul 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/07/19/e88bb1e8afade8af8de585b8e6b5b7e8af8de5aea2e688b7e7abafflashe78988efbc88flexe7a88be5ba8fe5a4aanbe595a6efbc89.html" title="英语词典海词客户端Flash版（Flex程序太NB啦）" rel="bookmark">英语词典海词客户端Flash版（Flex程序太NB啦）</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <p>英语词典海词客户端Flash版（Flex程序太NB啦）</p>

<p>昨晚看到了小妹的文章: http://args.cn/post/2009/01/course-sea-term-api-applications-word-query /，觉得有必要自己实现一个，以便日后查词典使用。</p>

<p>程序地址：http://liulantao.com/flex/dict.swf</p>

          <a href="/Technology/2010/07/19/e88bb1e8afade8af8de585b8e6b5b7e8af8de5aea2e688b7e7abafflashe78988efbc88flexe7a88be5ba8fe5a4aanbe595a6efbc89.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#Dict-ref">Dict <span>1</span></a></li>
     
    	<li><a href="/tags.html#Flash-ref">Flash <span>2</span></a></li>
     
    	<li><a href="/tags.html#Flex-ref">Flex <span>2</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-07-19 19:09:47 +0800">19 Jul 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/07/19/efbcbbe4bdbfe794a8e8b7afe794b1e599a8e5bf85e79c8befbcbdefbcbbe697a0e6b395e4b88ae4bca0e69687e4bbb6e5bf85e79c8befbcbde585b3e4ba8emtu.html" title="［使用路由器必看］［无法上传文件必看］关于MTU的那点事儿" rel="bookmark">［使用路由器必看］［无法上传文件必看］关于MTU的那点事儿</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <p>［使用路由器必看］［无法上传文件必看］关于MTU的那点事儿</p>

<p>路由器MTU与ISP不匹配导致无法上传文件</p>

<p>(1) 症状/问题表现
网站不能正常连接，或者连接上非常慢，或者无法上传或无法发送大文件。</p>

<p>(2) 关于MTU
MTU（Maximum Transmission Unit）是网络上传送的最大数据包，MTU的单位是字节。
MTU设置的标准是1500，大部分网络设备的MTU也都设置为1500，这样可以使的数据包在网络传输上获得最佳效率。
如果网络上某一个节点的MTU设置被人为调小(比如1460)，导致标准大小的数据包(1500)在这一节点被拆开来传送，这样会产生很多数据包碎片，增加丢包率，降低网络速度。而天朝的实际情况是，某些网络服务提供商会修改某些节点的MTU，以达到限制用户通过路由器共享带宽的目的。</p>

<p>把电脑或路由器的MTU调整为与网络服务提供商设备的MTU相同或稍小，就可以减少这种拆分，提供网络访问质量。一般情况下我们只需要设置路由器的 MTU值即可。</p>

<p>(3) 检查网络服务提供商设备的MTU值
开始菜单–程序–附件–命令提示符，输入以下命令：
ping -f – l 1500 www.renren.com
其中：
-l 1500 发送一个定长数据包，1500是测试数据包的大小；
–f 通知路由器不能私自更改该数据包大小。</p>

<p>在1500以下调整测试数据包的大小，观察反馈结果的变化并判断电信服务商设备的MTU值。
如果出现“Packet needs to be fragmented but DF set”，表示数据包需要被拆开来发送。
减少测试数据包长度，再执行上面的ping命令。重复几次，直到前面的提示消失，记下当时测试数据包的长度。
把测试数据包长度加上数据包头28字节，就得到MTU的值。</p>

<p>(4) 修改路由器MTU
在路由器的管理界面（怎么进入管理界面？看一下说明书吧），一般在“WAN设置”/“广域网设置”及其“高级设置”中，可以看到MTU设置。修改MTU为合适的数值（等于或稍小于网络服务提供商的MTU）后，保存设置重启路由器。</p>

<p>重启后，进入图片上传的网页（http://upload.renren.com/addphoto.do），传一张图片试试能不能成功。</p>

          <a href="/Technology/2010/07/19/efbcbbe4bdbfe794a8e8b7afe794b1e599a8e5bf85e79c8befbcbdefbcbbe697a0e6b395e4b88ae4bca0e69687e4bbb6e5bf85e79c8befbcbde585b3e4ba8emtu.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#MTU-ref">MTU <span>2</span></a></li>
     
    	<li><a href="/tags.html#无线路由器-ref">无线路由器 <span>1</span></a></li>
     
    	<li><a href="/tags.html#路由器-ref">路由器 <span>1</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-07-17 00:00:00 +0800">17 Jul 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/07/17/mtuisp.html" title="路由器MTU与ISP不匹配导致无法上传文件" rel="bookmark">路由器MTU与ISP不匹配导致无法上传文件</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <h2 class="title title-single">路由器MTU与ISP不匹配导致无法上传文件</h2><p>(1) 症状/问题表现<br> 网站不能正常连接，或者连接上非常慢，或者无法上传或无法发送大文件。</p> <p>(2) 关于MTU<br> MTU（Maximum Transmission Unit）是网络上传送的最大数据包，MTU的单位是字节。<br> MTU设置的标准是1500，大部分网络设备的MTU也都设置为1500，这样可以使的数据包在网络传输上获得最佳效率。<br> 如果网络上某一个节点的MTU设置被人为调小(比如1460)，导致标准大小的数据包(1500)在这一节点被拆开来传送，这样会产生很多数据包碎片，增 加丢包率，降低网络速度。而天朝的实际情况是，某些网络服务提供商会修改某些节点的MTU，以达到限制用户通过路由器共享带宽的目的。</p> <p>把电脑或路由器的MTU调整为与网络服务提供商设备的MTU相同或稍小，就可以减少这种拆分，提供网络访问质量。一般情况下我们只需要设置路由器的 MTU值即可。</p> <p>(3) 检查网络服务提供商设备的MTU值<br>  开始菜单–程序–附件–命令提示符，输入以下命令：<br> 　ping -f – l 1500 <a href="http://www.renren.com">www.renren.com</a><br> 其中：<br> -l 1500  发送一个定长数据包，1500是测试数据包的大小；<br> –f   通知路由器不能私自更改该数据包大小。</p> <p>在1500以下调整测试数据包的大小，观察反馈结果的变化并判断电信服务商设备的MTU值。<br> 如果出现"Packet needs to be fragmented but DF set"，表示数据包需要被拆开来发送。<br> 减少测试数据包长度，再执行上面的ping命令。重复几次，直到前面的提示消失，记下当时测试数据包的长度。<br> 把测试数据包长度加上数据包头28字节，就得到MTU的值。</p> <p>(4) 修改路由器MTU<br> 在路由器的管理界面（怎么进入管理界面？看一下说明书吧），一般在"WAN设置"/"广域网设置"及其"高级设置"中，可以看到MTU设置。修改MTU为 合适的数值（等于或稍小于网络服务提供商的MTU）后，保存设置重启路由器。</p> <p>重启后，进入图片上传的网页（<a href="http://upload.renren.com/addphoto.do">http://upload.renren.com/addphoto.do</a>），传一张图片试试能不能成功。</p><br clear="all"><br>-- <br>Liu Lantao<br>EMAIL: liulantao ( at ) gmail ( dot ) com ; <br>WEBSITE: <a href="http://www.liulantao.com/portal">http://www.liulantao.com/portal</a> .<br>  <div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/31667564-7679880555819417210?l=sandshoots.blogspot.com' alt='' /></div>

          <a href="/Technology/2010/07/17/mtuisp.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#MTU-ref">MTU <span>2</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
    <div class="full">
      <span class="date full-date">
        <abbr class="published" title="2010-06-08 00:00:00 +0800">08 Jun 2010</abbr>
      </span>
      <h3 class="entry-title">
        <a href="/Technology/2010/06/08/varnish-setup-in-steps.html" title="Varnish Setup in Steps" rel="bookmark">Varnish Setup in Steps</a>
      </h3>
      <p class="alt-font tight">
        <span>
          
        </span>
      </p>
      <div class="row">
        <div class="span8 entry-content full-content" style='background-color: #FFF; padding: 10px;'>
          <p>配置与编译</p>

<pre><code>./autogen.sh
./configure
make
</code></pre>

<p>测试</p>

<pre><code>cd bin/varnishtest &amp;&amp; ./varnishtest tests/*.vtc
</code></pre>

<p>安装</p>

<pre><code>make install
</code></pre>

<p>启动</p>

<pre><code>/data/varnish/sbin/varnishd -a 0.0.0.0:80 -s file,/data/vcache/varnish_cache.data,20g -f /data/varnish/etc/vcl.conf -p thread_pool_max=1500 -p thread_pools=8 -p listen_depth=512 -P /data/varnish/sbin/varnish.pid
</code></pre>

<p>重新载入</p>

<pre><code>kill -HUP `cat /data/varnish/sbin/varnish.pid`
</code></pre>

<p>关闭</p>

<pre><code>killall varnishd
</code></pre>

<p>&ndash; <br />Liu Lantao<br />EMAIL: liulantao ( at ) gmail ( dot ) com ; <br />WEBSITE: <a href="http://www.liulantao.com/">http://www.liulantao.com/</a> .<br />  &lt;div class="blogger-post-footer"&gt;<img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/31667564-2499494717203567834?l=sandshoots.blogspot.com" alt="" />&lt;/div&gt;</p>

          <a href="/Technology/2010/06/08/varnish-setup-in-steps.html" class="read_more span2 pull-right">[ Read More ]</a>
          <div class="clear"></div>
        </div>
        <div class="span3">
          
          <span>
            Posted in&nbsp;
            <ul>
            
              <li><a href="/categories.html#Technology-ref" title="Technology" rel="category tag">Technology</a></li>
            
            </ul>
          </span>
          
          
            <h4>Tags</h4>
            <ul class="tag_box">
            
            


  
     
    	<li><a href="/tags.html#Varnish-ref">Varnish <span>1</span></a></li>
    
  



            </ul>
           
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div class="rule"><hr/></div>
  
  
  
    <div id="post-pagination" class="pagination pagination-centered">
  <ul class="pages nav nav-pills">

  
    <li>
    
      <a href="/page6">Previous</a>
    
    </li>
  

  
    <li class="page">
      <a href="/">1</a>
    </li>
  

  
    
    <li class="page">
      <a href="/page2">2</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page3">3</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page4">4</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page5">5</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page6">6</a>
    </li>
    
  
    
    <li class="page active">
      <a href="#">7</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page8">8</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page9">9</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page10">10</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page11">11</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page12">12</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page13">13</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page14">14</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page15">15</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page16">16</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page17">17</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page18">18</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page19">19</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page20">20</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page21">21</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page22">22</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page23">23</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page24">24</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page25">25</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page26">26</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page27">27</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page28">28</a>
    </li>
    
  

  
    <li>
      <a href="/page8">Next</a>
    </li>
  

  </ul>
</div>


  
  </div>

  <div class='span3 sidebar'>
    <section>
      <img src="/images/public/qrcode_for_gh_9329e4243e67_258.jpg" />
    </section>

    <section>
  <h1>归档</h1>
  <ul id="archive_posts">
  
    
    
    
      <li><a href="/archive.html#archive_2013">2013</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2012">2012</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2011">2011</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2010">2010</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2009">2009</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2008">2008</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2007">2007</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2006">2006</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2005">2005</a></li>
    
  
    
    
    
      <li><a href="/archive.html#archive_2004">2004</a></li>
    
  
    
    
    
  
    
    
    
  
    
    
    
      <li><a href="/archive.html#archive_2003">2003</a></li>
    
  
    
    
    
  
    
    
    
  
  </ul>
</section>


    <section>
      <a class='pull-right' href="/atom.xml"><i class="icon-star"></i>RSS</a>
    </section>
  </div>
</div>

      </div>

      <footer>
        <p>&copy; Liu Lantao 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1658815-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  <script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

