
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Twitter的快速程序部署</title>
    
    <meta name="author" content="Liu Lantao">
    <meta property="wb:webmaster" content="08beceac65f1ad4f" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Lax's Blog</a>
          <ul class="nav">
            
            
            


  
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  




          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>Twitter的快速程序部署 <small></small></h1>
</div>

<div class="row">
  <div class="span8">
    <p>Twitter早期的更新采用Capistrano和Git，每次程序更新时间与服务起数目呈线性关系。当服务器数量迅速增加时，更新       效率开始成为问题。
基于中心代码库，更新时代码库压力较大。通过增加Git库的副本，可以缓解问题，但是从长期看，需要持续进行Git库扩展。</p>

<p>后来，Twitter引入去中心化的方案，在程序更新中采用BitTorrent，将更新时间从40分钟降低到12秒！</p>

<p>Capistrano： Ruby世界流行的一个部署框架，在实际服务器上执行任务。
Git：代码管理。
Murder：启动BTtracker，创建seeds，文件传输等任务。
BitTornado：对BitTorrent改造，更适合DataCenter内部高质量的网络环境。</p>

<h1 id="murder-fast-datacenter-code-deploys-using-------bittorrent">Murder: Fast datacenter code deploys using       BitTorrent</h1>

<h2 id="thursday-july-15-2010">Thursday, July 15, 2010</h2>

<p>Twitter has thousands of servers. What makes having           boatloads of servers particularly annoying though is that we           need to quickly get multiple iterations of code and binaries           onto all of them on a regular basis. We used to have a           git-based deploy system where we’d just instruct our           front-ends to download the latest code from our main git           machine and serve that. Unfortunately, once we got past a few           hundred servers, things got ugly. We recognized that this           problem was not unlike many of the scaling problems we’ve had           and dealt with in the past though &ndash; we were suffering the           symptoms of a centralized system.</p>

<p>By sitting beside a particularly vocal Release Engineer, I           received first-hand experience of the frustration caused by           slow deploys. We needed a way to dramatically speed things up.           I thought of some quick hacks to get this fixed: maybe           replicate the git repo or maybe shard it so everyone isn’t           hitting the same thing at once. Most of these           quasi-centralized solutions will still require re-replicating           or re-sharding again in the near future though (especially at           our growth). It was time for something completely different,           something decentralized, something more like.. <a href="http://bittorrent.com/">BitTorrent</a>.. running           inside of our datacenter to quickly copy files around. Using           the file-sharing protocol, we launched a side-project called           Murder and after a few days (and especially nights) of nervous           full-site tinkering, it turned a 40 minute deploy process into           one that lasted just 12 seconds!</p>

<p>Murder (which by the way is the name for a <a href="http://en.wikipedia.org/wiki/List_of_collective_nouns_for_birds">flock             of crows</a>) is a combination of scripts written in Python           and Ruby to easily deploy large binaries throughout your           company’s datacenter(s). It takes advantage of the fact that           the environment in a datacenter is somewhat different from           regular internet connections: low-latency access to servers,           high bandwidth, no NAT/Firewall issues, no ISP traffic           shaping, only trusted peers, etc. This let us come up with a           list of optimizations on top of BitTornado to make BitTorrent           not only reasonable, but also effective on our internal           network. Since at the time we used Capistrano for signaling           our servers to perform tasks, Murder also includes a           Capistrano deploy strategy to make it easy for existing users           of Capistrano to convert their file distribution to be           decentralized. The final component is the work Matt Freels (@<a href="http://twitter.com/mf">mf</a>) did in bundling           everything into an easy to install ruby gem. This further           helped get Murder to be usable for more deploy tasks at           Twitter.</p>

<p>Reference：
<a href="http://engineering.twitter.com/2010/07/murder-fast-datacenter-code-deploys.html">http://engineering.twitter.com/2010/07/murder-fast-datacenter-code-deploys.html</a>
Murder：（Python/Ruby）<a href="http://github.com/lg/murder">http://github.com/lg/murder</a></p>

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/Technology/2010/07/19/linux-e9a9b1e58aa8e5bc80e58f91e79a84e5ada6e4b9a0e6ada5e9aaa4.html" title="Linux 驱动开发的学习步骤">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2010/09/30/blog-post.html" title="此博客已移动">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <script type="text/javascript">
(function(){
var url = "http://widget.weibo.com/distribution/comments.php?width=0&url=auto&border=1&fontsize=12&skin=9&ralateuid=1772102214&appkey=446112883&iframskin=9&dpc=1";
url = url.replace("url=auto", "url=" + document.URL); 
document.write('<iframe id="WBCommentFrame" src="' + url + '" scrolling="no" frameborder="0" style="width:100%"></iframe>');
})();
</script>
<script src="http://tjs.sjs.sinajs.cn/open/widget/js/widget/comment.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
window.WBComment.init({
    "id": "WBCommentFrame"
});
</script>





  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>11 August 2010</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#deploy-ref">deploy <span>1</span></a></li>
     
    	<li><a href="/tags.html#twitter-ref">twitter <span>1</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Liu Lantao 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1658815-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

